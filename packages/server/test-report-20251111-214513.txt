================================================================================
Qwen Code HTTP服务 - 测试报告
================================================================================

测试时间: 2025年11月11日 星期二 21时45分13秒 CST
服务PID: 11156
服务端口: 3000

--------------------------------------------------------------------------------
配置信息
--------------------------------------------------------------------------------
.env文件: 存在
认证模式: 无认证（单用户模式）

--------------------------------------------------------------------------------
测试结果
--------------------------------------------------------------------------------
✅ 健康检查通过
✅ 就绪检查通过
✅ 会话创建成功
✅ 会话查询成功
✅ 会话列表成功
✅ SSE连接成功
✅ 历史记录API可用
✅ 文件操作API可用
✅ 取消接口可用
✅ 会话删除成功

--------------------------------------------------------------------------------
快速使用命令
--------------------------------------------------------------------------------

# 1. 创建会话
SESSION_ID=$(curl -s -X POST http://localhost:3000/api/session \
    -H "Content-Type: application/json" \
    -d '{"workspaceRoot":"/tmp/test"}' \
    | grep -o '"sessionId":"[^"]*"' | cut -d'"' -f4)

echo "Session ID: $SESSION_ID"

# 2. POST SSE聊天（支持中文，无需URL编码）
curl -X POST http://localhost:3000/api/chat/stream \
    -H "Content-Type: application/json" \
    -d "{\"sessionId\":\"$SESSION_ID\",\"message\":\"你好，请介绍一下你自己\"}"

# 3. 获取会话信息
curl -X POST http://localhost:3000/api/session/get \
    -H "Content-Type: application/json" \
    -d "{\"sessionId\":\"$SESSION_ID\"}"

# 4. 删除会话
curl -X POST http://localhost:3000/api/session/delete \
    -H "Content-Type: application/json" \
    -d "{\"sessionId\":\"$SESSION_ID\"}"

--------------------------------------------------------------------------------
API 优势
--------------------------------------------------------------------------------
✅ 统一使用 POST + JSON 格式
✅ 中文消息无需 URL 编码
✅ 更好的参数传递（支持复杂结构）
✅ 更好的安全性（敏感数据不在URL）

# 旧方式 (已废弃)
curl -N "http://localhost:3000/api/chat/stream?sessionId=$SESSION_ID&message=hello"

# 3. 获取会话信息
curl -s "http://localhost:3000/api/session/$SESSION_ID" | json_pp

# 4. 读取文件
curl -s -X POST http://localhost:3000/api/files/read \
    -H "Content-Type: application/json" \
    -d "{\"sessionId\":\"$SESSION_ID\",\"path\":\"/tmp/test/test.txt\"}" \
    | json_pp

# 5. 删除会话
curl -s -X DELETE "http://localhost:3000/api/session/$SESSION_ID"

--------------------------------------------------------------------------------
停止服务
--------------------------------------------------------------------------------
kill 11156

--------------------------------------------------------------------------------
注意事项
--------------------------------------------------------------------------------
1. SSE聊天需要配置AI模型才能返回实际内容
2. 当前 "Chat not initialized" 是预期的（缺少AI配置）
3. URL中包含 ? 和 & 时，必须用双引号包裹（zsh要求）
4. 修改.env后需要重启服务
5. 当前为无认证模式（单用户），所有API无需token

================================================================================
